<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DTA | Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --notion-bg: #ffffff;
            --notion-gray: #f7f6f3;
            --notion-gray-light: #fbfbfa;
            --notion-gray-dark: #e9e9e7;
            --notion-text: #37352f;
            --notion-text-light: #70716e;
            --notion-blue: #0c8ce9;
            --notion-blue-light: #e3f2fd;
            --notion-green: #0f7b6c;
            --notion-green-light: #e8f5e9;
            --notion-red: #d1453b;
            --notion-red-light: #ffebee;
            --notion-purple: #6940a5;
            --notion-purple-light: #f3e5f5;
            --notion-orange: #ff6b35;
            --notion-orange-light: #fff3e0;
            --notion-yellow: #ffb800;
            --notion-yellow-light: #fffde7;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --notion-bg: #1a1a1a;
                --notion-gray: #2d2d2d;
                --notion-gray-light: #252525;
                --notion-gray-dark: #3d3d3d;
                --notion-text: #ffffff;
                --notion-text-light: #aaaaaa;
                --notion-blue: #3b82f6;
                --notion-green: #10b981;
                --notion-red: #ef4444;
                --notion-purple: #8b5cf6;
                --notion-blue-light: rgba(59, 130, 246, 0.2);
                --notion-green-light: rgba(16, 185, 129, 0.2);
                --notion-red-light: rgba(239, 68, 68, 0.2);
                --notion-purple-light: rgba(139, 92, 246, 0.2);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--notion-bg);
            color: var(--notion-text);
            line-height: 1.5;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: env(safe-area-inset-top);
        }

        /* Prevent text size adjustment */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        /* Auth Overlay */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--notion-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--notion-gray);
            border-top-color: var(--notion-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .auth-message {
            font-size: 16px;
            color: var(--notion-text);
            margin-bottom: 20px;
            max-width: 300px;
            line-height: 1.4;
        }

        /* Mobile Header */
        .mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background-color: var(--notion-bg);
            border-bottom: 1px solid var(--notion-gray-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(var(--notion-bg), 0.95);
        }

        .mobile-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .mobile-header-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--notion-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mobile-menu-btn {
            width: 44px;
            height: 44px;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--notion-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: background-color 0.2s;
        }

        .mobile-menu-btn:active {
            background-color: var(--notion-gray);
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            background-color: var(--notion-bg);
            border-bottom: 1px solid var(--notion-gray-dark);
            padding: 16px;
            z-index: 99;
            display: none;
            flex-direction: column;
            gap: 8px;
            max-height: calc(100vh - 56px);
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .mobile-menu.active {
            display: flex;
        }

        .mobile-menu-item {
            padding: 16px;
            background-color: var(--notion-gray);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: inherit;
            text-align: left;
            transition: all 0.2s;
        }

        .mobile-menu-item:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .mobile-menu-item.primary {
            background-color: var(--notion-green);
            color: white;
            font-weight: 600;
        }

        /* Main Container */
        .main-container {
            margin: 56px 0 70px 0;
            padding: 0;
            width: 100%;
        }

        /* Welcome Section */
        .welcome-section {
            padding: 20px 16px;
            background: linear-gradient(135deg, var(--notion-purple-light), var(--notion-blue-light));
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--notion-text);
            line-height: 1.3;
        }

        .welcome-subtitle {
            font-size: 14px;
            color: var(--notion-text-light);
            line-height: 1.5;
        }

        /* Quick Stats - Mobile Optimized */
        .quick-stats {
            padding: 16px;
            background-color: var(--notion-bg);
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (max-width: 374px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            padding: 16px;
            background-color: var(--notion-gray-light);
            border-radius: 12px;
            border: 1px solid var(--notion-gray-dark);
            transition: transform 0.2s;
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-card .stat-label {
            font-size: 13px;
            color: var(--notion-text-light);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-card .stat-change {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .stat-card .stat-change.positive {
            background-color: var(--notion-green-light);
            color: var(--notion-green);
        }

        .stat-card .stat-change.negative {
            background-color: var(--notion-red-light);
            color: var(--notion-red);
        }

        .stat-card .stat-change.neutral {
            background-color: var(--notion-gray);
            color: var(--notion-text-light);
        }

        /* Recent Trades */
        .recent-trades {
            padding: 16px;
            background-color: var(--notion-gray-light);
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--notion-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-action {
            font-size: 14px;
            color: var(--notion-blue);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .section-action:active {
            background-color: var(--notion-gray);
        }

        .trades-table {
            background-color: var(--notion-bg);
            border-radius: 12px;
            border: 1px solid var(--notion-gray-dark);
            overflow: hidden;
        }

        .trade-row {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--notion-gray);
            transition: background-color 0.2s;
        }

        .trade-row:active {
            background-color: var(--notion-gray-light);
        }

        .trade-row:last-child {
            border-bottom: none;
        }

        .trade-pair {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pair-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background-color: var(--notion-blue-light);
            color: var(--notion-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .trade-result {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
            min-width: 70px;
            text-align: center;
        }

        .trade-result.win {
            background-color: var(--notion-green-light);
            color: var(--notion-green);
            border: 1px solid rgba(15, 123, 108, 0.2);
        }

        .trade-result.loss {
            background-color: var(--notion-red-light);
            color: var(--notion-red);
            border: 1px solid rgba(209, 69, 59, 0.2);
        }

        .trade-result.break-even {
            background-color: var(--notion-gray);
            color: var(--notion-text-light);
            border: 1px solid var(--notion-gray-dark);
        }

        .trade-pl {
            font-weight: 700;
            font-size: 14px;
            min-width: 60px;
            text-align: right;
        }

        .trade-pl.positive {
            color: var(--notion-green);
        }

        .trade-pl.negative {
            color: var(--notion-red);
        }

        /* Quick Actions - Mobile Optimized */
        .quick-actions {
            padding: 16px;
            background-color: var(--notion-bg);
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (max-width: 374px) {
            .actions-grid {
                grid-template-columns: 1fr;
            }
        }

        .action-card {
            padding: 20px 16px;
            background-color: var(--notion-gray-light);
            border-radius: 12px;
            border: 1px solid var(--notion-gray-dark);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .action-card:active {
            transform: scale(0.98);
            background-color: var(--notion-gray);
        }

        .action-card .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: var(--notion-blue-light);
            color: var(--notion-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px auto;
            font-size: 20px;
        }

        .action-card:nth-child(1) .action-icon {
            background-color: var(--notion-green-light);
            color: var(--notion-green);
        }

        .action-card:nth-child(2) .action-icon {
            background-color: var(--notion-purple-light);
            color: var(--notion-purple);
        }

        .action-card:nth-child(3) .action-icon {
            background-color: var(--notion-orange-light);
            color: var(--notion-orange);
        }

        .action-card:nth-child(4) .action-icon {
            background-color: var(--notion-yellow-light);
            color: var(--notion-yellow);
        }

        .action-card .action-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .action-card .action-desc {
            font-size: 12px;
            color: var(--notion-text-light);
            line-height: 1.4;
        }

        /* Performance Chart - Mobile Optimized */
        .performance-chart {
            padding: 16px;
            background-color: var(--notion-gray-light);
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .chart-container {
            background-color: var(--notion-bg);
            border-radius: 12px;
            border: 1px solid var(--notion-gray-dark);
            padding: 16px;
            height: 300px;
            position: relative;
        }

        /* Insights Section */
        .insights-section {
            padding: 16px;
            background-color: var(--notion-bg);
            border-bottom: 1px solid var(--notion-gray-dark);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        @media (max-width: 374px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        .insight-card {
            padding: 16px;
            background-color: var(--notion-gray-light);
            border-radius: 12px;
            border: 1px solid var(--notion-gray-dark);
            text-align: center;
        }

        .insight-card .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: var(--notion-blue-light);
            color: var(--notion-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px auto;
            font-size: 18px;
        }

        .insight-card .insight-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .insight-card .insight-label {
            font-size: 12px;
            color: var(--notion-text-light);
            line-height: 1.3;
        }

        /* Bottom Navigation - Mobile Only */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--notion-bg);
            border-top: 1px solid var(--notion-gray-dark);
            display: flex;
            padding: 8px 16px;
            z-index: 100;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(20px);
            background: rgba(var(--notion-bg), 0.95);
            height: 70px;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                display: none;
            }
        }

        .bottom-nav-btn {
            flex: 1;
            padding: 12px 8px;
            background: none;
            border: none;
            border-radius: 12px;
            font-size: 11px;
            color: var(--notion-text-light);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            min-height: 52px;
        }

        .bottom-nav-btn.active {
            color: var(--notion-blue);
            background-color: var(--notion-blue-light);
        }

        .bottom-nav-btn:active {
            transform: scale(0.95);
        }

        .bottom-nav-btn i {
            font-size: 20px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--notion-text-light);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--notion-gray-dark);
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--notion-text);
        }

        .empty-state-text {
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px 20px;
            color: var(--notion-text-light);
            flex-direction: column;
            gap: 20px;
            min-height: 200px;
        }

        .loading i {
            animation: spin 1s linear infinite;
            font-size: 40px;
            color: var(--notion-blue);
        }

        .loading-text {
            font-size: 16px;
            text-align: center;
            max-width: 200px;
            line-height: 1.4;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Desktop Styles */
        @media (min-width: 768px) {
            .mobile-header {
                display: none;
            }
            
            .mobile-menu {
                display: none;
            }
            
            .bottom-nav {
                display: none;
            }
            
            .main-container {
                margin: 0;
                padding: 24px;
                max-width: 1200px;
                margin: 0 auto;
                padding-bottom: 40px;
            }
            
            .welcome-section {
                border-radius: 16px;
                margin-bottom: 24px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }
            
            .actions-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }
            
            .insights-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }
            
            .chart-container {
                height: 350px;
            }
        }

        /* Landscape Mode Optimizations */
        @media (max-width: 767px) and (orientation: landscape) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .actions-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .insights-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .chart-container {
                height: 250px;
            }
        }

        /* Extra Small Devices */
        @media (max-width: 374px) {
            .welcome-title {
                font-size: 22px;
            }
            
            .stat-card {
                padding: 14px;
            }
            
            .action-card {
                padding: 16px 12px;
            }
            
            .chart-container {
                height: 250px;
            }
        }

        /* Safe Area Support for Notched Phones */
        @supports (padding: max(0px)) {
            .mobile-header {
                padding-top: max(16px, env(safe-area-inset-top));
                height: calc(56px + env(safe-area-inset-top));
            }
            
            .main-container {
                margin-top: calc(56px + env(safe-area-inset-top));
            }
            
            .mobile-menu {
                top: calc(56px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: max(8px, env(safe-area-inset-bottom));
                height: calc(70px + env(safe-area-inset-bottom));
            }
        }

        /* Performance Optimizations */
        .trades-table {
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        /* Touch Feedback */
        .touch-feedback:active {
            opacity: 0.7;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--notion-gray);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--notion-text-light);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--notion-text);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--notion-green);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 3000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
            max-width: 90%;
            text-align: center;
            display: none;
        }

        .toast.error {
            background-color: var(--notion-red);
        }

        .toast.show {
            display: block;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(0); opacity: 1; }
            to { transform: translateX(-50%) translateY(20px); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Auth Overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-spinner"></div>
        <div class="auth-message" id="authMessage">Loading dashboard...</div>
    </div>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-left">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="mobile-header-title">Dashboard</div>
        </div>
        <button class="mobile-menu-btn" id="mobileAddTradeBtn">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="dashboard.html" class="mobile-menu-item active">
            <i class="fas fa-home"></i>
            Dashboard
        </a>
        <a href="journal.html" class="mobile-menu-item">
            <i class="fas fa-book"></i>
            Trading Journal
        </a>
        <a href="analysis.html" class="mobile-menu-item">
            <i class="fas fa-chart-line"></i>
            Analysis
        </a>
        <a href="add-trade.html" class="mobile-menu-item primary">
            <i class="fas fa-plus-circle"></i>
            Add New Trade
        </a>
        <button class="mobile-menu-item" id="mobileLogoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            Logout
        </button>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title" id="welcomeTitle">Welcome back, Trader!</h1>
            <p class="welcome-subtitle">Here's your trading overview for today</p>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    <span>Quick Stats</span>
                </div>
            </div>
            <div class="stats-grid" id="quickStats">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </div>

        <!-- Recent Trades -->
        <div class="recent-trades">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-history"></i>
                    <span>Recent Trades</span>
                </div>
                <a href="journal.html" class="section-action">
                    View All
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="trades-table" id="recentTrades">
                <!-- Recent trades will be populated by JavaScript -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-bolt"></i>
                    <span>Quick Actions</span>
                </div>
            </div>
            
            <div class="actions-grid">
                <a href="add-trade.html" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="action-title">Add Trade</div>
                    <div class="action-desc">Record a new trade</div>
                </a>
                
                <a href="journal.html" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="action-title">View Journal</div>
                    <div class="action-desc">Browse all trades</div>
                </a>
                
                <a href="analysis.html" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="action-title">Analytics</div>
                    <div class="action-desc">Detailed analysis</div>
                </a>
                
                <a href="#" class="action-card" id="exportDataBtn">
                    <div class="action-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="action-title">Export Data</div>
                    <div class="action-desc">Download CSV</div>
                </a>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="performance-chart">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i>
                    <span>30-Day Performance</span>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <!-- Insights Section -->
        <div class="insights-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    <span>Trading Insights</span>
                </div>
            </div>
            
            <div class="insights-grid" id="insightsGrid">
                <!-- Insights will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="bottom-nav-btn active">
            <i class="fas fa-home"></i>
            Dashboard
        </button>
        <button class="bottom-nav-btn" onclick="window.location.href='journal.html'">
            <i class="fas fa-book"></i>
            Journal
        </button>
        <button class="bottom-nav-btn" onclick="window.location.href='analysis.html'">
            <i class="fas fa-chart-line"></i>
            Analysis
        </button>
        <button class="bottom-nav-btn" onclick="window.location.href='settings.html'">
            <i class="fas fa-cog"></i>
            Settings
        </button>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDuaP43jD8LWw5A8cIbcgS7-bqCZTXzEEg",
            authDomain: "davily-feded.firebaseapp.com",
            databaseURL: "https://davily-feded-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "davily-feded",
            storageBucket: "davily-feded.firebasestorage.app",
            messagingSenderId: "83255410493",
            appId: "1:83255410493:web:927c5e859c5b20805c4f54",
            measurementId: "G-LD4XHS6FGM"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let userTrades = [];
        let performanceChart = null;

        // Initialize Page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            setupEventListeners();
            setupTouchEvents();
        });

        // Setup Event Listeners
        function setupEventListeners() {
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobileAddTradeBtn').addEventListener('click', () => {
                window.location.href = 'add-trade.html';
            });
            document.getElementById('mobileLogoutBtn').addEventListener('click', logoutUser);
            
            // Export data
            document.getElementById('exportDataBtn').addEventListener('click', (e) => {
                e.preventDefault();
                exportData();
            });
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                const mobileMenu = document.getElementById('mobileMenu');
                const menuBtn = document.getElementById('mobileMenuBtn');
                
                if (mobileMenu.classList.contains('active') && 
                    !mobileMenu.contains(e.target) && 
                    !menuBtn.contains(e.target)) {
                    mobileMenu.classList.remove('active');
                }
            });
            
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // Setup Touch Events
        function setupTouchEvents() {
            const recentTrades = document.getElementById('recentTrades');
            
            if (recentTrades) {
                recentTrades.addEventListener('touchstart', handleTouchStart, { passive: true });
                recentTrades.addEventListener('touchend', handleTouchEnd, { passive: true });
            }
        }

        let touchStartY = 0;
        let touchEndY = 0;

        function handleTouchStart(e) {
            touchStartY = e.changedTouches[0].screenY;
        }

        function handleTouchEnd(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleVerticalSwipe();
        }

        function handleVerticalSwipe() {
            const minSwipeDistance = 50;
            const swipeDistanceY = touchEndY - touchStartY;
            
            if (Math.abs(swipeDistanceY) > minSwipeDistance) {
                if (swipeDistanceY < 0) {
                    // Swipe up - could be used for refresh
                    showToast('Pull down to refresh');
                }
            }
        }

        // Check Authentication
        function checkAuthentication() {
            const authOverlay = document.getElementById('authOverlay');
            const authMessage = document.getElementById('authMessage');
            
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    document.getElementById('welcomeTitle').textContent = `Welcome back, ${user.displayName || 'Trader'}!`;
                    authMessage.textContent = "Loading your dashboard...";
                    await loadDashboardData();
                    authOverlay.classList.add('hidden');
                } else {
                    authMessage.textContent = 'Redirecting to login...';
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                }
            });
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                showLoading();
                
                // Load user trades
                const snapshot = await database.ref('userTrades/' + currentUser.uid + '/trades').once('value');
                userTrades = [];
                
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const trade = childSnapshot.val();
                        trade.id = childSnapshot.key;
                        
                        // Ensure all required fields exist
                        trade.date = trade.date || trade.createdAt || Date.now();
                        trade.pair = trade.pair || 'Unknown';
                        trade.direction = trade.direction || 'Long';
                        trade.result = trade.result || 'Break Even';
                        trade.pl = trade.pl || 0;
                        trade.rr = trade.rr || null;
                        trade.riskPercent = trade.riskPercent || null;
                        trade.session = trade.session || null;
                        trade.setup = trade.setup || null;
                        trade.notes = trade.notes || null;
                        
                        userTrades.push(trade);
                    });
                    
                    console.log(`Loaded ${userTrades.length} trades`);
                } else {
                    console.log('No trades found for user');
                }

                // Sort by date (newest first)
                userTrades.sort((a, b) => b.date - a.date);

                // Update all sections
                updateQuickStats();
                updateRecentTrades();
                updatePerformanceChart();
                updateInsights();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Failed to load dashboard data. Please refresh.', true);
                showErrorState();
            }
        }

        // Show Loading State
        function showLoading() {
            const sections = ['quickStats', 'recentTrades', 'insightsGrid'];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.innerHTML = `
                        <div class="loading" style="grid-column: 1/-1; width: 100%;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <div class="loading-text">Loading...</div>
                        </div>
                    `;
                }
            });
        }

        // Show Error State
        function showErrorState() {
            const sections = ['quickStats', 'recentTrades', 'insightsGrid'];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.innerHTML = `
                        <div class="empty-state" style="grid-column: 1/-1; width: 100%;">
                            <div class="empty-state-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="empty-state-text">Failed to load data</div>
                            <button onclick="retryLoading()" style="margin-top: 12px; padding: 8px 16px; background-color: var(--notion-blue); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                Retry
                            </button>
                        </div>
                    `;
                }
            });
        }

        // Retry Loading
        function retryLoading() {
            loadDashboardData();
        }

        // Update Quick Stats
        function updateQuickStats() {
            const quickStats = document.getElementById('quickStats');
            
            if (userTrades.length === 0) {
                const emptyStats = `
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-chart-line"></i>
                            <span>Total Trades</span>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">No trades yet</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-trophy"></i>
                            <span>Win Rate</span>
                        </div>
                        <div class="stat-value">0%</div>
                        <div class="stat-change neutral">Start trading</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-dollar-sign"></i>
                            <span>Net P/L</span>
                        </div>
                        <div class="stat-value">$0</div>
                        <div class="stat-change neutral">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            <i class="fas fa-calendar"></i>
                            <span>Today's Trades</span>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">--</div>
                    </div>
                `;
                quickStats.innerHTML = emptyStats;
                return;
            }

            // Calculate statistics
            const totalTrades = userTrades.length;
            const winningTrades = userTrades.filter(t => t.result === 'Win').length;
            const winRate = totalTrades > 0 ? Math.round((winningTrades / totalTrades) * 100) : 0;
            const netPL = userTrades.reduce((sum, trade) => sum + (trade.pl || 0), 0);
            
            // Today's trades
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayTrades = userTrades.filter(trade => {
                const tradeDate = new Date(trade.date);
                tradeDate.setHours(0, 0, 0, 0);
                return tradeDate.getTime() === today.getTime();
            }).length;

            // Yesterday's trades for comparison
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0, 0, 0, 0);
            const yesterdayTrades = userTrades.filter(trade => {
                const tradeDate = new Date(trade.date);
                tradeDate.setHours(0, 0, 0, 0);
                return tradeDate.getTime() === yesterday.getTime();
            }).length;

            const tradesChange = todayTrades - yesterdayTrades;
            const tradesChangeText = tradesChange > 0 ? `+${tradesChange}` : tradesChange;

            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-chart-line"></i>
                        <span>Total Trades</span>
                    </div>
                    <div class="stat-value">${totalTrades}</div>
                    <div class="stat-change ${totalTrades >= 10 ? 'positive' : 'neutral'}">
                        ${totalTrades >= 10 ? 'Good volume' : 'Build consistency'}
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-trophy"></i>
                        <span>Win Rate</span>
                    </div>
                    <div class="stat-value">${winRate}%</div>
                    <div class="stat-change ${winRate >= 50 ? 'positive' : 'negative'}">
                        ${winRate >= 50 ? '✓ Good' : '✗ Needs work'}
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Net P/L</span>
                    </div>
                    <div class="stat-value">$${netPL >= 0 ? '+' : ''}${netPL.toFixed(0)}</div>
                    <div class="stat-change ${netPL >= 0 ? 'positive' : 'negative'}">
                        ${netPL >= 0 ? '✓ Profitable' : '✗ Loss'}
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-calendar"></i>
                        <span>Today's Trades</span>
                    </div>
                    <div class="stat-value">${todayTrades}</div>
                    <div class="stat-change ${tradesChange > 0 ? 'positive' : tradesChange < 0 ? 'negative' : 'neutral'}">
                        ${tradesChange > 0 ? `+${tradesChange}` : tradesChange < 0 ? tradesChange : '0'} from yesterday
                    </div>
                </div>
            `;
            
            quickStats.innerHTML = statsHTML;
        }

        // Update Recent Trades
        function updateRecentTrades() {
            const recentTrades = document.getElementById('recentTrades');
            const recentTradesList = userTrades.slice(0, 5);

            if (recentTradesList.length === 0) {
                recentTrades.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="empty-state-title">No trades yet</div>
                        <div class="empty-state-text">Start your trading journey by adding your first trade</div>
                        <a href="add-trade.html" style="display: inline-block; margin-top: 16px; padding: 12px 24px; background-color: var(--notion-green); color: white; border-radius: 12px; text-decoration: none; font-weight: 600;">
                            <i class="fas fa-plus-circle"></i>
                            Add First Trade
                        </a>
                    </div>
                `;
                return;
            }

            let tradesHTML = '';
            recentTradesList.forEach(trade => {
                const date = new Date(trade.date);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
                
                let timeAgo;
                if (diffHours < 1) {
                    const diffMinutes = Math.floor(diffTime / (1000 * 60));
                    timeAgo = `${diffMinutes}m ago`;
                } else if (diffHours < 24) {
                    timeAgo = `${diffHours}h ago`;
                } else {
                    const diffDays = Math.floor(diffHours / 24);
                    timeAgo = `${diffDays}d ago`;
                }
                
                const plValue = trade.pl || 0;
                const plClass = plValue > 0 ? 'positive' : plValue < 0 ? 'negative' : '';
                const plSign = plValue > 0 ? '+' : '';
                const plDisplay = `${plSign}$${Math.abs(plValue).toFixed(0)}`;
                
                const pairAbbr = trade.pair ? trade.pair.replace('/', '').substring(0, 3).toUpperCase() : 'N/A';
                
                tradesHTML += `
                    <div class="trade-row" onclick="viewTrade('${trade.id}')" style="cursor: pointer;">
                        <div class="trade-pair">
                            <div class="pair-icon">${pairAbbr}</div>
                            <div>
                                <div style="font-weight: 600;">${trade.pair || 'N/A'}</div>
                                <div style="font-size: 12px; color: var(--notion-text-light);">${timeAgo}</div>
                            </div>
                        </div>
                        <div class="trade-result ${trade.result ? trade.result.toLowerCase().replace(' ', '-') : ''}">
                            ${trade.result || 'N/A'}
                        </div>
                        <div class="trade-pl ${plClass}">
                            ${plDisplay}
                        </div>
                    </div>
                `;
            });

            recentTrades.innerHTML = tradesHTML;
        }

        // View Trade Details
        function viewTrade(tradeId) {
            const trade = userTrades.find(t => t.id === tradeId);
            if (!trade) return;
            
            window.location.href = `trade-detail.html?id=${tradeId}`;
        }

        // Update Performance Chart
        function updatePerformanceChart() {
            const ctx = document.getElementById('performanceChart');
            
            // Destroy existing chart if it exists
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            // Calculate 30-day performance
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 29); // 30 days including today
            
            // Group trades by day for the last 30 days
            const dailyData = {};
            const labels = [];
            
            // Initialize last 30 days
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateKey = date.toISOString().split('T')[0];
                const labelDate = new Date(date);
                dailyData[dateKey] = 0;
                labels.push(labelDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            }
            
            // Sum P/L by day
            userTrades.forEach(trade => {
                const tradeDate = new Date(trade.date);
                const dateKey = tradeDate.toISOString().split('T')[0];
                if (dailyData[dateKey] !== undefined) {
                    dailyData[dateKey] += trade.pl || 0;
                }
            });
            
            // Convert to array for chart
            const plValues = Object.values(dailyData);
            
            // Calculate cumulative P/L
            let cumulative = 0;
            const cumulativeData = plValues.map(value => {
                cumulative += value;
                return cumulative;
            });
            
            // Determine chart color based on performance
            const finalPL = cumulativeData[cumulativeData.length - 1] || 0;
            const chartColor = finalPL >= 0 ? '#0f7b6c' : '#d1453b';
            const bgColor = finalPL >= 0 ? 'rgba(15, 123, 108, 0.1)' : 'rgba(209, 69, 59, 0.1)';
            
            // Create chart
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cumulative P/L',
                        data: cumulativeData,
                        borderColor: chartColor,
                        backgroundColor: bgColor,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 3,
                        pointHoverRadius: 6,
                        pointBackgroundColor: chartColor,
                        pointBorderColor: 'white',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `P/L: $${context.raw.toFixed(0)}`;
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    },
                    scales: {
                        x: {
                            grid: { 
                                display: false,
                                drawBorder: false
                            },
                            ticks: { 
                                maxRotation: 0,
                                font: {
                                    size: 11
                                },
                                color: 'var(--notion-text-light)'
                            }
                        },
                        y: {
                            grid: { 
                                color: 'rgba(0,0,0,0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                },
                                font: {
                                    size: 11
                                },
                                color: 'var(--notion-text-light)'
                            },
                            beginAtZero: true
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.4
                        }
                    }
                }
            });
        }

        // Update Insights
        function updateInsights() {
            const insightsGrid = document.getElementById('insightsGrid');
            
            if (userTrades.length === 0) {
                insightsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="empty-state-text">Start trading to see insights</div>
                    </div>
                `;
                return;
            }

            // Calculate insights
            const totalTrades = userTrades.length;
            const winningTrades = userTrades.filter(t => t.result === 'Win').length;
            const losingTrades = userTrades.filter(t => t.result === 'Loss').length;
            const breakEvenTrades = userTrades.filter(t => t.result === 'Break Even').length;
            
            // Average R:R
            const tradesWithRR = userTrades.filter(t => t.rr && t.rr > 0);
            const avgRR = tradesWithRR.length > 0 
                ? (tradesWithRR.reduce((sum, t) => sum + t.rr, 0) / tradesWithRR.length).toFixed(1)
                : '0.0';
            
            // Most traded pair
            const pairCounts = {};
            userTrades.forEach(trade => {
                const pair = trade.pair || 'Unknown';
                pairCounts[pair] = (pairCounts[pair] || 0) + 1;
            });
            const mostTradedPair = Object.entries(pairCounts).sort((a, b) => b[1] - a[0])[0];
            
            // Best day of week
            const dayCounts = {};
            userTrades.forEach(trade => {
                const date = new Date(trade.date);
                const day = date.getDay(); // 0 = Sunday, 1 = Monday, etc.
                dayCounts[day] = (dayCounts[day] || 0) + 1;
            });
            const bestDayNum = Object.entries(dayCounts).sort((a, b) => b[1] - a[1])[0];
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const bestDay = bestDayNum ? days[bestDayNum[0]] : 'N/A';
            
            // Win rate by session
            const sessionStats = {};
            userTrades.forEach(trade => {
                const session = trade.session || 'Unknown';
                if (!sessionStats[session]) {
                    sessionStats[session] = { wins: 0, total: 0 };
                }
                sessionStats[session].total++;
                if (trade.result === 'Win') {
                    sessionStats[session].wins++;
                }
            });
            
            let bestSession = 'N/A';
            let bestSessionRate = 0;
            Object.entries(sessionStats).forEach(([session, stats]) => {
                const rate = stats.total > 0 ? (stats.wins / stats.total) * 100 : 0;
                if (rate > bestSessionRate) {
                    bestSessionRate = rate;
                    bestSession = session;
                }
            });
            
            const insightsHTML = `
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="insight-value">${avgRR}:1</div>
                    <div class="insight-label">Avg Risk:Reward</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="insight-value">${mostTradedPair ? mostTradedPair[0] : 'N/A'}</div>
                    <div class="insight-label">Most Traded Pair</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="insight-value">${bestDay.substring(0, 3)}</div>
                    <div class="insight-label">Best Day</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="insight-value">${bestSession}</div>
                    <div class="insight-label">Best Session</div>
                </div>
            `;
            
            insightsGrid.innerHTML = insightsHTML;
        }

        // Export Data
        function exportData() {
            if (userTrades.length === 0) {
                showToast('No data to export', true);
                return;
            }
            
            try {
                // Create CSV content
                const headers = ['Date', 'Time', 'Pair', 'Direction', 'Result', 'P/L ($)', 'R:R', 'Risk %', 'Session', 'Setup', 'Notes'];
                const csvData = [
                    headers.join(','),
                    ...userTrades.map(trade => {
                        const date = new Date(trade.date);
                        const dateStr = date.toLocaleDateString('en-CA'); // YYYY-MM-DD format
                        const timeStr = date.toLocaleTimeString('en-GB'); // HH:MM:SS format
                        
                        return [
                            dateStr,
                            timeStr,
                            trade.pair || '',
                            trade.direction || '',
                            trade.result || '',
                            trade.pl || 0,
                            trade.rr || '',
                            trade.riskPercent || '',
                            trade.session || '',
                            trade.setup || '',
                            `"${(trade.notes || '').replace(/"/g, '""')}"`
                        ].join(',');
                    })
                ].join('\n');
                
                // Create download link
                const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `trading-journal-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Data exported successfully!');
                
            } catch (error) {
                console.error('Error exporting data:', error);
                showToast('Failed to export data', true);
            }
        }

        // Show Toast Notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${isError ? 'error' : ''}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Toggle Mobile Menu
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('active');
        }

        // Logout User
        function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                }).catch(error => {
                    console.error('Logout error:', error);
                    showToast('Error logging out. Please try again.', true);
                });
            }
        }

        // Expose functions to global scope
        window.toggleMobileMenu = toggleMobileMenu;
        window.logoutUser = logoutUser;
        window.viewTrade = viewTrade;
        window.retryLoading = retryLoading;
    </script>
</body>
</html>

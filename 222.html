<!DOCTYPE html>
<html lang="fr" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atijara Al Ama - ERP Gestion Commerciale</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #f5f7fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--light); color: #333; }

        /* --- UI COMPONENTS --- */
        .header { background: var(--primary); color: white; height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; position: fixed; width: 100%; top: 0; z-index: 1000; }
        .sidebar { width: 250px; background: white; height: 100vh; position: fixed; right: 0; top: 70px; box-shadow: -2px 0 5px rgba(0,0,0,0.05); }
        .sidebar-menu { list-style: none; padding: 20px 0; }
        .sidebar-menu a { display: flex; align-items: center; padding: 15px 25px; color: #555; text-decoration: none; border-right: 4px solid transparent; }
        .sidebar-menu a.active { background: #e8f4fc; color: var(--secondary); border-right-color: var(--secondary); }
        .main-content { margin-right: 250px; padding: 100px 30px 30px; }

        /* --- TABLE STYLE --- */
        .table-container { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8f9fa; padding: 12px; text-align: right; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .status { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status-delivered { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }

        /* --- BUTTONS --- */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; }

        /* --- A5 PRINT TEMPLATE --- */
        #a5DeliveryNote { 
            display: none; 
            width: 148mm; 
            min-height: 210mm; 
            padding: 10mm; 
            background: white; 
            margin: 0 auto; 
            border: 1px solid #ddd;
            direction: rtl;
        }

        .header-bl { display: flex; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .bl-label-box { text-align: center; margin: 20px 0; }
        .bl-label-box h2 { border: 2px solid #000; display: inline-block; padding: 5px 30px; }
        .items-table-print { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .items-table-print th, .items-table-print td { border: 1px solid #000; padding: 8px; text-align: center; }
        .items-table-print th { background: #f2f2f2 !important; }

        /* --- MEDIA PRINT CORRECTION --- */
        @media print {
            body * { visibility: hidden; }
            #a5DeliveryNote, #a5DeliveryNote * { visibility: visible; }
            #a5DeliveryNote { 
                display: block !important; 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 148mm; 
                height: 210mm; 
                border: none;
            }
            .no-print { display: none !important; }
            @page { size: A5 portrait; margin: 0; }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo"><h2>Atijara Al Ama</h2></div>
        <div class="user">Ahmed Mansouri - Admin</div>
    </header>

    <nav class="sidebar">
        <ul class="sidebar-menu">
            <li><a href="#" class="active"><i class="fas fa-tachometer-alt"></i> &nbsp; Tableau de Bord</a></li>
            <li><a href="#"><i class="fas fa-truck-loading"></i> &nbsp; Bons de Livraison</a></li>
            <li><a href="#"><i class="fas fa-boxes"></i> &nbsp; Stock</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="page-title" style="display:flex; justify-content: space-between; margin-bottom: 20px;">
            <h2>Bons de Livraison Récents</h2>
            <button class="btn btn-primary" onclick="openNewBL()"><i class="fas fa-plus"></i> Nouveau BL</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>N° BL</th>
                        <th>Client</th>
                        <th>Date</th>
                        <th>Montant</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bl-list">
                    </tbody>
            </table>
        </div>
    </main>

    <div class="modal" id="printModal">
        <div class="modal-content">
            <div class="no-print" style="margin-bottom: 20px; text-align: left;">
                <button class="btn btn-success" onclick="window.print()"><i class="fas fa-print"></i> Imprimer (A5)</button>
                <button class="btn" onclick="closeModal()">Fermer</button>
            </div>
            
            <div id="a5DeliveryNote">
                </div>
        </div>
    </div>

    <script>
        // Données Simulées
        const data = {
            company: { name: "ATIJARA AL AMA SARL", address: "Casablanca, Maroc", tel: "+212 522 00 11 22" },
            blList: [
                { id: 1, ref: "BL-2024-001", client: "Client Alpha", date: "2024-01-20", total: 1500, status: "delivered", 
                  items: [{name: "Produit A", qty: 10, price: 100}, {name: "Produit B", qty: 5, price: 100}] },
                { id: 2, ref: "BL-2024-002", client: "Client Beta", date: "2024-01-22", total: 850, status: "pending",
                  items: [{name: "Produit C", qty: 2, price: 425}] }
            ]
        };

        // Charger la liste des BL
        function renderBLList() {
            const container = document.getElementById('bl-list');
            container.innerHTML = data.blList.map(bl => `
                <tr>
                    <td>${bl.ref}</td>
                    <td>${bl.client}</td>
                    <td>${bl.date}</td>
                    <td>${bl.total.toFixed(2)} DH</td>
                    <td><span class="status status-${bl.status}">${bl.status === 'delivered' ? 'Livré' : 'En attente'}</span></td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px;" onclick="printBL(${bl.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Préparer l'impression A5
        function printBL(id) {
            const bl = data.blList.find(x => x.id === id);
            const printArea = document.getElementById('a5DeliveryNote');

            printArea.innerHTML = `
                <div class="header-bl">
                    <div>
                        <h3>${data.company.name}</h3>
                        <p style="font-size:11px">${data.company.address}</p>
                        <p style="font-size:11px">Tél: ${data.company.tel}</p>
                    </div>
                    <div style="text-align:left">
                        <p><strong>Réf:</strong> ${bl.ref}</p>
                        <p><strong>Date:</strong> ${bl.date}</p>
                    </div>
                </div>

                <div class="bl-label-box">
                    <h2>BON DE LIVRAISON</h2>
                </div>

                <div style="margin-bottom: 20px;">
                    <p><strong>CLIENT:</strong> ${bl.client}</p>
                </div>

                <table class="items-table-print">
                    <thead>
                        <tr>
                            <th>Désignation</th>
                            <th>Qté</th>
                            <th>P.U (DH)</th>
                            <th>Total (DH)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bl.items.map(item => `
                            <tr>
                                <td style="text-align:right">${item.name}</td>
                                <td>${item.qty}</td>
                                <td>${item.price.toFixed(2)}</td>
                                <td>${(item.qty * item.price).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>

                <div style="margin-top: 20px; text-align: left;">
                    <p style="font-size: 18px;"><strong>TOTAL NET: ${bl.total.toFixed(2)} DH</strong></p>
                </div>

                <div style="margin-top: 50px; display: flex; justify-content: space-between;">
                    <div style="text-align: center; width: 40%;">Signature Client<br><br>...................</div>
                    <div style="text-align: center; width: 40%;">Cachet Société<br><br>
                        <div style="border: 2px solid #1a4a7a; color: #1a4a7a; padding: 5px; transform: rotate(-10deg); font-weight: bold; display: ${bl.status === 'delivered' ? 'block' : 'none'}">LIVRÉ</div>
                    </div>
                </div>
            `;

            document.getElementById('printModal').style.display = 'flex';
            document.getElementById('a5DeliveryNote').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('printModal').style.display = 'none';
        }

        window.onload = renderBLList;
    </script>
</body>
</html>
